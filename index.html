<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Qlix 2 (ALPHA)</title>

<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;700&display=swap" rel="stylesheet">

<style>
:root {
  --panel: rgba(255,255,255,0.15);
  --radius: 16px;
  --shadow: 0 8px 24px rgba(0,0,0,0.35);
}

body{
  margin:0;
  font-family:'Comfortaa',sans-serif;
  background:#547538;
  color:black;
}

.topbar{
  position:sticky;
  top:0;
  background:black;
  padding:10px 16px;
  display:flex;
  align-items:center;
}

.logo{color:white;font-weight:700;}

.wrap{
  display:grid;
  grid-template-columns:260px 1fr;
  gap:16px;
  max-width:1100px;
  margin:14px auto;
  padding:0 16px;
}

.card,.post{
  background:var(--panel);
  padding:14px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}

.profile-pic{
  width:32px;
  height:32px;
  border-radius:50%;
  object-fit:cover;
}

.btn{
  padding:8px 12px;
  border:none;
  border-radius:12px;
  cursor:pointer;
}

a{color:inherit;text-decoration:none;}
</style>
</head>
<body>

<header class="topbar">
  <div class="logo">Qlix 2</div>
  <button id="googleSignInBtn" class="btn" style="margin-left:auto;">Sign in with Google</button>
  <button id="signOutBtn" class="btn" style="display:none;">Sign Out</button>
</header>

<main class="wrap">

  <aside>
    <div class="card" id="userInfo" style="display:none;">
      <img id="userPic" class="profile-pic">
      <div id="userName"></div>
    </div>
  </aside>

  <section>
    <div class="card" id="composer" style="display:none;">
      <textarea id="postText" placeholder="What's on your mind?" style="width:100%;"></textarea>
      <button id="postBtn" class="btn">Post</button>
    </div>

    <div id="feed"></div>
  </section>

</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, arrayUnion, arrayRemove, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyDP0yDxmCrcIXK_DkdXJZB_XzPRVPXMCyo",
 authDomain:"qlix-2701b.firebaseapp.com",
 projectId:"qlix-2701b"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);
const provider=new GoogleAuthProvider();

let currentUser=null;

const googleBtn=document.getElementById("googleSignInBtn");
const signOutBtn=document.getElementById("signOutBtn");
const composer=document.getElementById("composer");
const feed=document.getElementById("feed");

googleBtn.onclick=()=>signInWithPopup(auth,provider);
signOutBtn.onclick=()=>signOut(auth);

onAuthStateChanged(auth,user=>{
 currentUser=user;

 if(user){
   googleBtn.style.display="none";
   signOutBtn.style.display="block";
   composer.style.display="block";
 }else{
   googleBtn.style.display="block";
   signOutBtn.style.display="none";
   composer.style.display="none";
 }
});

postBtn.onclick=async()=>{
 const text=postText.value.trim();
 if(!text) return;

 await addDoc(collection(db,"posts"),{
   text,
   authorName: currentUser.displayName,
   authorId: currentUser.uid,
   authorPic: currentUser.photoURL,
   likes: [],
   timestamp: serverTimestamp()
 });

 postText.value="";
};

onSnapshot(collection(db,"posts"), snapshot=>{
 feed.innerHTML="";

 snapshot.docs
  .sort((a,b)=>b.data().timestamp?.toMillis()-a.data().timestamp?.toMillis())
  .forEach(docSnap=>{
   const data=docSnap.data();
   const liked=data.likes?.includes(currentUser?.uid);

   const postDiv=document.createElement("div");
   postDiv.className="post";

   postDiv.innerHTML=`
     <div style="display:flex;gap:8px;align-items:center;">
       <img class="profile-pic" src="${data.authorPic}">
       <a href="profile.html?uid=${data.authorId}">
         <strong>${data.authorName}</strong>
       </a>
     </div>
     <p>${data.text}</p>
     <button data-id="${docSnap.id}" data-liked="${liked}">
       ${liked?'‚ù§Ô∏è':'ü§ç'} ${data.likes?.length||0}
     </button>
   `;

   feed.appendChild(postDiv);
 });

 document.querySelectorAll("button[data-id]").forEach(btn=>{
   btn.onclick=async()=>{
     const ref=doc(db,"posts",btn.dataset.id);
     const liked=btn.dataset.liked==="true";

     if(liked){
       await updateDoc(ref,{likes:arrayRemove(currentUser.uid)});
     }else{
       await updateDoc(ref,{likes:arrayUnion(currentUser.uid)});
     }
   };
 });
});
</script>

</body>
</html>
