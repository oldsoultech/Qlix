<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Qlix 2 (ALPHA)</title>

<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;700&display=swap" rel="stylesheet">

<style>
:root{
  --panel: rgba(255,255,255,0.15);
  --radius:16px;
  --shadow:0 8px 24px rgba(0,0,0,0.35);
}

body{
  margin:0;
  font-family:'Comfortaa',sans-serif;
  background:#547538;
  color:black;
}

.topbar{
  position:sticky;
  top:0;
  backdrop-filter:blur(10px);
  background:black;
  padding:10px 16px;
  display:flex;
  align-items:center;
  gap:10px;
}

.logo{
  font-weight:800;
  color:white;
}

.wrap{
  display:grid;
  grid-template-columns:260px 1fr;
  gap:16px;
  max-width:1100px;
  margin:14px auto;
  padding:0 16px;
}

.card,.composer,.post{
  background:var(--panel);
  padding:14px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}

.feed{display:grid;gap:12px;}

.profile-pic{
  width:32px;
  height:32px;
  border-radius:50%;
  object-fit:cover;
}

.btn{
  padding:8px 12px;
  border-radius:12px;
  border:none;
  cursor:pointer;
  font-family:inherit;
}

.primary{
  background:white;
  color:#547538;
  font-weight:700;
}

textarea{
  width:100%;
  min-height:70px;
  padding:10px;
  border-radius:12px;
  border:none;
  background:rgba(255,255,255,0.8);
}

a{color:inherit;text-decoration:none;}
</style>
</head>
<body>

<header class="topbar">
  <div class="logo">Qlix 2 (ALPHA)</div>

  <div style="margin-left:auto;">
    <button class="btn" id="googleSignInBtn">Sign in with Google</button>
    <button class="btn" id="signOutBtn" style="display:none;">Sign Out</button>
  </div>
</header>

<main class="wrap">

  <aside>
    <div class="card" id="userInfo" style="display:none;">
  <img id="userPic" class="profile-pic">
  <div id="userName"></div>

  <button class="btn" onclick="location.href='profile.html?edit=true'">
    Edit Profile
  </button>
</div>
  </aside>

  <section>
    <div class="card composer" id="composer" style="display:none;">
      <textarea id="postText" placeholder="What's on your mind?"></textarea>
      <button class="btn primary" id="postBtn">Post</button>
    </div>

    <div class="feed" id="feed"></div>
  </section>

</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, arrayUnion, arrayRemove, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyDP0yDxmCrcIXK_DkdXJZB_XzPRVPXMCyo",
 authDomain:"qlix-2701b.firebaseapp.com",
 projectId:"qlix-2701b"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);
const provider=new GoogleAuthProvider();

let currentUser=null;

const googleBtn=document.getElementById("googleSignInBtn");
const signOutBtn=document.getElementById("signOutBtn");
const composer=document.getElementById("composer");
const feed=document.getElementById("feed");

googleBtn.onclick=()=>signInWithPopup(auth,provider);
signOutBtn.onclick=()=>signOut(auth);

onAuthStateChanged(auth,user=>{
  currentUser=user;

  if(user){
    googleBtn.style.display="none";
    signOutBtn.style.display="inline-block";
    composer.style.display="block";

    userInfo.style.display="block";
    userPic.src=user.photoURL;
    userName.textContent=user.displayName;
  }else{
    googleBtn.style.display="inline-block";
    signOutBtn.style.display="none";
    composer.style.display="none";
    userInfo.style.display="none";
  }
});

postBtn.onclick=async()=>{
  const text=postText.value.trim();
  if(!text) return;

  await addDoc(collection(db,"posts"),{
    text,
    authorName:currentUser.displayName,
    authorId:currentUser.uid,
    authorPic:currentUser.photoURL,
    likes:[],
    timestamp:serverTimestamp()
  });

  postText.value="";
};

onSnapshot(collection(db,"posts"), snapshot=>{
  feed.innerHTML="";

  snapshot.docs
    .sort((a,b)=>b.data().timestamp?.toMillis()-a.data().timestamp?.toMillis())
    .forEach(docSnap=>{
      const data=docSnap.data();
      const liked=data.likes?.includes(currentUser?.uid);

      const div=document.createElement("div");
      div.className="post";

      div.innerHTML=`
        <div style="display:flex;gap:10px;align-items:center;">
          <img class="profile-pic" src="${data.authorPic}">
          <a href="profile.html?uid=${data.authorId}">
            <strong>${data.authorName}</strong>
          </a>
        </div>
        <p>${data.text}</p>
        <button data-id="${docSnap.id}" data-liked="${liked}">
          ${liked?'‚ù§Ô∏è':'ü§ç'} ${data.likes?.length||0}
        </button>
      `;

      feed.appendChild(div);
    });

  document.querySelectorAll("button[data-id]").forEach(btn=>{
    btn.onclick=async()=>{
      const ref=doc(db,"posts",btn.dataset.id);
      const liked=btn.dataset.liked==="true";

      if(liked){
        await updateDoc(ref,{likes:arrayRemove(currentUser.uid)});
      }else{
        await updateDoc(ref,{likes:arrayUnion(currentUser.uid)});
      }
    };
  });
});
</script>

</body>
</html>
