<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Qlix</title>
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --panel: rgba(255,255,255,0.15);
    --text: #ffffff;
    --muted: rgba(255,255,255,0.7);
    --radius: 16px;
    --shadow: 0 8px 24px rgba(0,0,0,0.35);
  }
  body {margin:0; font-family:'Comfortaa', sans-serif; background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); color: var(--text);}
  a{color:inherit;text-decoration:none}
  button,input,textarea{font:inherit;color:inherit}
  .topbar{position:sticky;top:0;backdrop-filter:blur(10px);background:rgba(0,0,0,0.4); padding:10px 16px;display:flex;align-items:center;gap:10px;}
  .logo{font-weight:800;letter-spacing:.3px;}
  .wrap{display:grid;grid-template-columns:260px 1fr;gap:16px;max-width:1100px;margin:14px auto;padding:0 16px;}
  .sidebar{position:sticky;top:64px;align-self:start;}
  .card{background:var(--panel);padding:14px;border-radius:var(--radius);box-shadow:var(--shadow);backdrop-filter:blur(10px);}
  .composer textarea{width:100%;min-height:70px;padding:10px;border-radius:12px;border:none;background:rgba(255,255,255,0.3);color:#fff;resize:vertical;}
  .feed{display:grid;gap:12px;}
  .post{background:var(--panel);padding:12px;border-radius:14px;box-shadow:var(--shadow);}
  .post .meta{display:flex;gap:10px;font-size:14px;}
  .post .actions{display:flex;gap:10px;margin-top:8px;}
  .btn{padding:8px 12px;border-radius:12px;border:none;cursor:pointer;transition:.2s;}
  .btn:hover{opacity:.9;}
  .primary{background:#fff;color:#ff4b1f;font-weight:700;}
  .auth-section{display:flex;gap:8px;margin-bottom:10px;}
</style>
</head>
<body>

<header class="topbar">
  <div class="logo">Qlix</div>
</header>

<main class="wrap">
  <aside class="sidebar">
    <div class="card" id="authCard">
      <div class="auth-section" id="googleAuth">
        <button class="btn" id="googleSignInBtn">Sign in with Google</button>
        <button class="btn" id="signOutBtn" style="display:none;">Sign Out</button>
      </div>
      <div class="auth-section" id="emailAuth">
        <input type="email" id="emailInput" placeholder="Email" style="flex:1;padding:6px;border-radius:8px;border:none;">
        <input type="password" id="passInput" placeholder="Password" style="flex:1;padding:6px;border-radius:8px;border:none;">
        <button class="btn primary" id="emailSignUpBtn">Sign Up</button>
        <button class="btn primary" id="emailSignInBtn">Sign In</button>
      </div>
      <div id="userInfo" style="display:none; margin-top:10px;">
        <div id="userName"></div>
      </div>
    </div>
  </aside>
  <section style="flex:1;">
    <div class="card composer" id="composer" style="display:none;">
      <textarea id="postText" placeholder="What's on your mind?"></textarea>
      <button class="btn primary" id="postBtn">Post</button>
    </div>
    <div class="feed" id="feed"></div>
  </section>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, arrayUnion, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDP0yDxmCrcIXK_DkdXJZB_XzPRVPXMCyo",
  authDomain: "qlix-2701b.firebaseapp.com",
  projectId: "qlix-2701b",
  storageBucket: "qlix-2701b.firebasestorage.app",
  messagingSenderId: "882570053949",
  appId: "1:882570053949:web:7a7ba161e25cead8bfdd54",
  measurementId: "G-YM9QHYSSXW"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

const googleBtn = document.getElementById("googleSignInBtn");
const signOutBtn = document.getElementById("signOutBtn");
const composer = document.getElementById("composer");
const feed = document.getElementById("feed");
const userNameEl = document.getElementById("userName");

const emailInput = document.getElementById("emailInput");
const passInput = document.getElementById("passInput");
const emailSignUpBtn = document.getElementById("emailSignUpBtn");
const emailSignInBtn = document.getElementById("emailSignInBtn");

let currentUser = null;

googleBtn.addEventListener("click", async () => {
  try {
    const result = await signInWithPopup(auth, provider);
    currentUser = result.user;
    loginUI();
  } catch(e){ console.error(e); alert("Google sign-in failed."); }
});

signOutBtn.addEventListener("click", async () => {
  await signOut(auth);
  currentUser = null;
  loginUI();
});

emailSignUpBtn.addEventListener("click", async()=>{
  try{
    const userCred = await createUserWithEmailAndPassword(auth,emailInput.value,passInput.value);
    currentUser = userCred.user;
    loginUI();
  }catch(e){console.error(e); alert("Email sign-up failed.");}
});

emailSignInBtn.addEventListener("click", async()=>{
  try{
    const userCred = await signInWithEmailAndPassword(auth,emailInput.value,passInput.value);
    currentUser = userCred.user;
    loginUI();
  }catch(e){console.error(e); alert("Email sign-in failed.");}
});

function loginUI(){
  if(currentUser){
    googleBtn.style.display = "none";
    signOutBtn.style.display = "inline-block";
    composer.style.display = "grid";
    emailSignUpBtn.style.display = emailSignInBtn.style.display = 'none';
    userNameEl.textContent = currentUser.displayName || currentUser.email;
    document.getElementById("userInfo").style.display="block";
  } else {
    googleBtn.style.display = "inline-block";
    signOutBtn.style.display = "none";
    composer.style.display = "none";
    emailSignUpBtn.style.display = emailSignInBtn.style.display = 'inline-block';
    document.getElementById("userInfo").style.display="none";
  }
}

onAuthStateChanged(auth,user=>{currentUser=user; loginUI();});

// Posts
const postsCol = collection(db,"posts");
const postsQuery = query(postsCol, orderBy("timestamp","desc"));

onSnapshot(postsQuery, snapshot=>{
  feed.innerHTML="";
  snapshot.docs.forEach(docSnap=>{
    const data = docSnap.data();
    const postDiv = document.createElement("div");
    postDiv.className="post";
    postDiv.innerHTML=`<div class="meta"><strong>${data.authorName}</strong></div>
      <div>${data.text}</div>
      <div class="actions">
        <button class="btn" data-id="${docSnap.id}" data-type="like">Like (${data.likes?.length||0})</button>
      </div>`;
    feed.appendChild(postDiv);
  });
  document.querySelectorAll("[data-type='like']").forEach(btn=>{
    btn.onclick=async()=>{
      if(!currentUser) return;
      const postRef = doc(db,"posts",btn.dataset.id);
      try{ await updateDoc(postRef,{likes: arrayUnion(currentUser.uid)}); }catch(e){console.error(e); alert("Failed to like post.");}
    };
  });
});

document.getElementById("postBtn").addEventListener("click", async()=>{
  const text = document.getElementById("postText").value.trim();
  if(!text||!currentUser) return;
  try{
    await addDoc(collection(db,"posts"),{
      text,
      authorName: currentUser.displayName||currentUser.email,
      likes: [],
      timestamp: serverTimestamp()
    });
    document.getElementById("postText").value="";
  }catch(e){console.error(e); alert("Failed to post.");}
});

</script>
</body>
</html>
